<!doctype html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="Content-Style-Type" content="text/css">
    <meta http-equiv="Content-Script-Type" content="text/javascript">
    <link rel="stylesheet" type="text/css" href="style.css" />
    <title>ポリカ測り販売表</title>
</head>

<body>
    <div class="order-box">
        <h3>オーダーメイド計算システム</h3>
        <p class="order-att">必要なサイズと数量をご入力いただければ、お見積もり金額が計算できます。参考としてご活用ください。</p>
        <form name="form" id="form" method="post" onsubmit="return onSubmit()" accept-charset="EUC-JP"
            action="https://basket.step.rakuten.co.jp/rms/mall/bs/cartadd/set" target="_parent">

            <div class="inputsize-box ordrecon">
                <h5>１.基本寸法をご入力ください</h5>
                <ul>
                    <li>※1) 最小注文サイズは100mm × 100mm以上、縦×横の面積が0.01㎡以上必要になります。（交差-0mm + 2mm）</li>
                    <li>※2) 最大サイズ以内でしかご注文できません。</li>
                    <li>※3) 1mm単位でカットは可能ですが、鋸厚などの関係によって多少の誤差が出る場合がございます。</li>
                </ul>
                <div class="inner-boxs">
                    <p class="inputbox"><span>縦</span><input type="text" name="height" onChange="validate(this.form)"
                            value="500">mm</p>
                    <span class="kakeru">×</span>
                    <p class="inputbox"><span>横</span><input type="text" name="width" onChange="validate(this.form)"
                            value="500">mm</p>
                </div>
            </div>

            <div class="inputthick-box ordrecon">
                <h5>２.板厚をご確認ください</h5>
                <div class="inner-boxs">
                    <span>板厚</span>
                    <select name="thickness" onChange="validate(this.form)">
                        <option value="3.0">3.0</option>
                    </select>mm
                </div>
            </div>

            <div class="inputnum-box ordrecon">
                <h5>３.数量をご入力ください</h5>
                <div class="inner-boxs">
                    <input size="15" type="text" name="input_units" value="1" onChange="validate(this.form)"> 枚
                </div>
            </div>

            <div class="comfirm-box ordrecon">
                <input type="button" value="見積もりを表示する" onclick="calculateEstimate(this.form)">
                <input type="button" value="見積もり内容をクリア" onclick="clearEstimate(this.form)">
                <textarea name="estimate" id="estimate" cols="80" rows="10" readonly></textarea>
            </div>
            <div class="attention-box">
                <p>※1.注文個数には<span class="dot-text">ご希望の枚数</span>をご記入ください。</p>
                <p>※2.注文を進んでいただき、<span class="dot-text">備考欄にご希望のサイズを明記ください</span>。</p>
                <p>※3.ご注文確定後の<span class="dot-text">サイズ変更等はお受けできません</span></p>
                <p>※4.<span class="dot-text">お客様都合での返品や交換はお受けできません</span>ので、サイズ等しっかりとご確認の上、ご注文下さい。</p>
                <p>※5.送料は一律2000円ですが、大きさや送る地域によっては別途運賃が発しすることがあります。沖縄、離島への送料はお見積りになります。</p>
            </div><!-- END.attention-box -->



            <input type="hidden" name="order_price" id="order_price" value="0">
            <!-- rat submit form data -->
            <input type="hidden" name="__event" value="ES01_003_001">
            <input type="hidden" name="shop_bid" value="340101">
            <input type="hidden" name="item_id" value="10002128">/*商品番号*/
            <input type="hidden" name="inventory_flag" value="0">
            <input type="hidden" name="units" id="units" />
            <input type="hidden" name="choice" id="choice1" value="">
            <input type="hidden" name="choice" id="choice2" value="">
            <input type="hidden" name="choice" id="choice3" value="">
            <input type="hidden" name="choice" id="choice4" value="">
        </form>
    </div><!-- END.order-box -->

    <script type="text/javascript">
        const INIT_HEIGHT = 500;	// [初期値] 縦幅
        const INIT_WIDTH = 500;		// [初期値] 横幅
        const INIT_UNITS = 0;	// [初期値] 数量
        const UNIT_PIRCE_100 = 100;	// 買い物かごの中の商品単価(注文価格をコノ単価で割ると「数量になる」）

        /**
        * 入力値チェック(縦横幅/数量/板厚)
        * @type {form}
        */
        function validate(form) {
            const height = parseFloat(form.height.value);		// 縦幅(ミリ)
            const width = parseFloat(form.width.value);			// 横幅(ミリ)
            const input_input_units = parseFloat(form.input_units.value);	// 数量
            const thickness = parseFloat(form.thickness.value);	// 板厚(ミリ)

            //------縦幅チェック------//
            if (height > 3000 || 100 > height) {
                alert("範囲内で指定して下さい");
                form.height.value = INIT_HEIGHT;
            } else if (height % 1 > 0.0) {
                alert("整数で入力して下さい");
                form.height.value = INIT_HEIGHT;
            }
            //------横幅チェック------//
            else if (width > 3000 || 100 > width) {
                alert("範囲内で指定して下さい");
                form.width.value = INIT_WIDTH;
            } else if (width % 1 > 0.0) {
                alert("整数で入力して下さい");
                form.width.value = INIT_WIDTH;
            }
            //------寸法チェック------//
            else if (width * height / 1000000 < 0.01) {
                alert("縦×横の寸法は0.01㎡以上に指定して下さい");
                form.height.value = INIT_HEIGHT;
                form.width.value = INIT_WIDTH;
            }
            //------数量チェック------//
            else if (0 > input_units) {
                alert("1以上で入力して下さい");
                form.input_units.value = INIT_UNITS;
            } else if (input_units % 1 > 0.0) {
                alert("整数で入力して下さい");
                form.input_units.value = INIT_UNITS;
            }
        }

        /**
        * 「見積もりを表示する」ボタン押下
        * @type {form}
        */
        function calculateEstimate(form) {

            // 固定値
            const R_NET = 1;                        // Net掛け率
            const R_MAT = 6870;                     // 1平米あたりの材料単価
            const R_MAT_P_BIL = R_MAT / 1000000;    // 1平米あたりの材料単価 ワル 1,000,000
            const SHIPPING_FEES = 3000              // 送料(円)
            const TAX = 1.10                        // 税率

            // 入力値
            const height = parseFloat(form.height.value);		// 縦幅(ミリ)
            const width = parseFloat(form.width.value);			// 横幅(ミリ)
            const thickness = parseFloat(form.thickness.value);	// 板厚(ミリ)
            const input_units = parseFloat(form.input_units.value);	// 数量

            //------材料費の算出------//
            // 板厚*(縦横幅㎡)*材料単価*数量
            const mat_cost = (height * width) * R_MAT_P_BIL * input_units;

            //------価格(税込み)の算出------//
            // 価格 -> 材料費 * Net掛け率 * 税率 (100円単位で繰り上げ)
            const priceWithTax = Math.ceil(mat_cost * R_NET * TAX / UNIT_PIRCE_100) * UNIT_PIRCE_100;

            // 価格計算に失敗(または数量入力が0)した場合
            if (priceWithTax <= 0 || isNaN(priceWithTax) || input_units == 0) {
                form.estimate.value = "";
                form.order_price.value = 0;
                form.units.value = 0;
                alert('価格計算に失敗しました。入力値に誤りがあります。');
                return;
            }

            // 見積り表示
            const choice_str_01 = `【サイズ】縦: ${height}mm 横: ${width}mm`;
            const choice_str_02 = `【板厚】板厚: ${thickness}mm`;
            const choice_str_03 = `【数量】${input_units}枚`;
            const choice_str_04 = `【価格】${priceWithTax.toLocaleString()} 円（税込）`;
            form.estimate.value = `${choice_str_01}
${choice_str_02}
${choice_str_03}
${choice_str_04}`;
            // set 買い物カゴに表示する「商品名」に記載する情報
            document.getElementById('choice1').value = choice_str_01;
            document.getElementById('choice2').value = choice_str_02;
            document.getElementById('choice3').value = choice_str_03;
            document.getElementById('choice4').value = choice_str_04;
            // set 税込み価格
            document.form.order_price.value = priceWithTax;
            // set 買い物かごの中の商品数量
            document.form.units.value = priceWithTax / UNIT_PIRCE_100;
        }

        /**
        * 「見積もり内容をクリアする」ボタン押下
        */
        function clearEstimate(form) {
            form.estimate.value = "";
            document.form.order_price.value = 0;
            document.form.units.value = 0;
        }

        /**
        * 「上記の内容で購入する」ボタン押下
        */
        function onSubmit() {
            const order_price = document.form.order_price.value;
            const approve_checked = document.form.approve.checked;

            // 見積前 or 注意事項の了承前
            if (order_price <= 0) { alert('注文内容が表示されていません。'); return false; }
            if (approve_checked == false) { alert('注意事項の承認が必要です。'); return false; }

            // 楽天へリクエストするpriceをセット(購入金額 / 100円)
            document.form.units.value = order_price / UNIT_PIRCE_100

            const msg = `ご購入金額：${order_price}円（税込み）

※システムの都合上、買い物かごの中の商品単価は${UNIT_PIRCE_100}円、注文数量が「${document.form.units.value}」と表示されます。
こちらは購入金額の計算に必要になりますので、変更されないようにお願いいたします。`;
            flag = confirm(msg);
            return flag;
        }
    </script>
</body>

</html>